name: Robot Framework CI

on: [push, pull_request]

permissions: # 권한 명시
  contents: write

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          rfbrowser init

      - name: Run Robot Framework Tests
        run: |
          # 1. results 폴더 미리 생성
          mkdir -p results
          
          # 2. 'tests' 폴더 대신 현재 위치(.)에서 모든 .robot 파일을 찾아 실행
          # 만약 폴더명이 'test'(단수)이거나 대문자 'Tests'여도 다 찾아냅니다.
          robot -d results . || true
          
          # 3. 파일이 생성되었는지 확인 후 복사
          if [ -f "results/log.html" ]; then
            cp results/log.html results/index.html
          else
            echo "Error: log.html was not created!"
            exit 1
          fi

      # 핵심: GitHub Pages로 결과 파일 배포
      - name: Deploy Report to GitHub Pages
        if: always()
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./results  # results 폴더 안의 내용(log.html 등)을 배포