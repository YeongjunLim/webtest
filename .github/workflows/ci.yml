name: Robot Framework CI

on: [push, pull_request]

permissions: # 권한 명시
  contents: write

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          pip install -r requirements.txt
          rfbrowser init

      - name: Run Robot Framework Tests
        run: |
          # 결과가 없으면 배포가 안되므로, 테스트가 실패해도 계속 진행
          robot -d results tests/ || true
          # log.html을 index.html로 복사해서 주소만 쳐도 나오게 함
          cp results/log.html results/index.html

      # 핵심: GitHub Pages로 결과 파일 배포
      - name: Deploy Report to GitHub Pages
        if: always()
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./results  # results 폴더 안의 내용(log.html 등)을 배포